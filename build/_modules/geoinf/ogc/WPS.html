

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>geoinf.ogc.WPS &mdash; EO4vistrails v1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="EO4vistrails v1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">EO4vistrails v1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for geoinf.ogc.WPS</h1><div class="highlight"><pre>
<span class="c">###########################################################################</span>
<span class="c">##</span>
<span class="c">## Copyright (C) 2010 CSIR Meraka Institute. All rights reserved.</span>
<span class="c">##</span>
<span class="c">## eo4vistrails extends VisTrails, providing GIS/Earth Observation</span>
<span class="c">## ingestion, pre-processing, transformation, analytic and visualisation</span>
<span class="c">## capabilities . Included is the abilty to run code transparently in</span>
<span class="c">## OpenNebula cloud environments. There are various software</span>
<span class="c">## dependencies, but all are FOSS.</span>
<span class="c">##</span>
<span class="c">## This file may be used under the terms of the GNU General Public</span>
<span class="c">## License version 2.0 as published by the Free Software Foundation</span>
<span class="c">## and appearing in the file LICENSE.GPL included in the packaging of</span>
<span class="c">## this file.  Please review the following to ensure GNU General Public</span>
<span class="c">## Licensing requirements will be met:</span>
<span class="c">## http://www.opensource.org/licenses/gpl-license.php</span>
<span class="c">##</span>
<span class="c">## If you are unsure which license is appropriate for your use (for</span>
<span class="c">## instance, you are interested in developing a commercial derivative</span>
<span class="c">## of VisTrails), please contact us at vistrails@sci.utah.edu.</span>
<span class="c">##</span>
<span class="c">## This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
<span class="c">## WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="c">##</span>
<span class="c">############################################################################</span>
<span class="sd">&quot;&quot;&quot;This module provides an OGC (Open Geospatial Consortium) Web Processing</span>
<span class="sd">Service (WPS) Client via pyWPS.</span>

<span class="sd">This code is based on ideas and methods from the QGIS WPS Plugin (09/11/2009)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c"># library</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">httplib</span> <span class="kn">import</span> <span class="o">*</span> <span class="c">#??? are we using this</span>
<span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="c"># third party</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtNetwork</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtXml</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c"># vistrails</span>
<span class="kn">from</span> <span class="nn">core.modules.module_descriptor</span> <span class="kn">import</span> <span class="n">ModuleDescriptor</span>
<span class="kn">from</span> <span class="nn">core.modules.module_configure</span> <span class="kn">import</span> <span class="n">StandardModuleConfigurationWidget</span>
<span class="kn">from</span> <span class="nn">core.modules.module_registry</span> <span class="kn">import</span> <span class="n">get_module_registry</span>
<span class="kn">from</span> <span class="nn">core.modules.vistrails_module</span> <span class="kn">import</span> <span class="n">Module</span><span class="p">,</span> <span class="n">new_module</span><span class="p">,</span> <span class="n">NotCacheable</span><span class="p">,</span>\
    <span class="n">ModuleError</span>
<span class="kn">from</span> <span class="nn">core.utils</span> <span class="kn">import</span> <span class="n">PortAlreadyExists</span>
<span class="kn">from</span> <span class="nn">core.modules.basic_modules</span> <span class="kn">import</span> <span class="n">String</span>
<span class="c"># eo4vistrails</span>
<span class="kn">from</span> <span class="nn">packages.eo4vistrails.geoinf.datamodels</span> <span class="kn">import</span> <span class="n">QgsLayer</span>
<span class="kn">from</span> <span class="nn">packages.eo4vistrails.geoinf.ogc.PortConfigurationWidget</span> <span class="kn">import</span> \
    <span class="n">Port</span><span class="p">,</span> <span class="n">PortConfigurationWidget</span>
<span class="c"># local</span>
<span class="kn">import</span> <span class="nn">init</span>


<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
<span class="c"># All supported import raster formats [mime type, GDAL id]</span>
<span class="n">RASTER_MIMETYPES</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;IMAGE/TIFF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GTiff&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;IMAGE/PNG&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;PNG&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;IMAGE/GIF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GIF&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;IMAGE/JPEG&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;JPEG&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;IMAGE/GEOTIFF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GTiff&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/X-ERDAS-HFA&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;HFA&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/NETCDF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;netCDF&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/X-NETCDF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;netCDF&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/GEOTIFF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GTiff&quot;</span><span class="p">},</span> \
                    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/X-GEOTIFF&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GTiff&quot;</span><span class="p">}]</span>
<span class="c"># All supported input vector formats [mime type, schema, GDAL id]</span>
<span class="n">VECTOR_MIMETYPES</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;TEXT/XML&quot;</span><span class="p">,</span> <span class="s">&quot;SCHEMA&quot;</span><span class="p">:</span><span class="s">&quot;GML&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GML&quot;</span><span class="p">},</span> \
    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/XML&quot;</span><span class="p">,</span> <span class="s">&quot;SCHEMA&quot;</span><span class="p">:</span><span class="s">&quot;GML&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;GML&quot;</span><span class="p">},</span> \
    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;TEXT/XML&quot;</span><span class="p">,</span> <span class="s">&quot;SCHEMA&quot;</span><span class="p">:</span><span class="s">&quot;KML&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;KML&quot;</span><span class="p">},</span> \
    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/DGN&quot;</span><span class="p">,</span> <span class="s">&quot;SCHEMA&quot;</span><span class="p">:</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;DGN&quot;</span><span class="p">},</span> \
    <span class="p">{</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">:</span><span class="s">&quot;APPLICATION/SHP&quot;</span><span class="p">,</span> <span class="s">&quot;SCHEMA&quot;</span><span class="p">:</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;GDALID&quot;</span><span class="p">:</span><span class="s">&quot;ESRI_Shapefile&quot;</span><span class="p">}]</span>
<span class="c"># Other constants</span>
<span class="n">DEFAULT_URL</span> <span class="o">=</span> <span class="s">&#39;http://ict4eo.meraka.csir.co.za/cgi-bin/wps.py&#39;</span>
<span class="n">MAP_LAYER</span> <span class="o">=</span> <span class="s">&#39;za.co.csir.eo4vistrails:QgsMapLayer:data&#39;</span>


<div class="viewcode-block" id="xmlExecuteRequestInputStart"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.xmlExecuteRequestInputStart">[docs]</a><span class="k">def</span> <span class="nf">xmlExecuteRequestInputStart</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:Input xmlns:wps=&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="se">\</span>
<span class="s">                      xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;wps:Input&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;ows:Identifier&gt;&quot;</span> <span class="o">+</span> <span class="n">identifier</span> <span class="o">+</span> <span class="s">&quot;&lt;/ows:Identifier&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;ows:Title&gt;&quot;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&quot;&lt;/ows:Title&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;wps:Data&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;Invalid Layer Identifier&#39;</span><span class="p">,</span>\
                        <span class="s">&#39;Unable to create ows:Identifier&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="xmlExecuteRequestInputEnd"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.xmlExecuteRequestInputEnd">[docs]</a><span class="k">def</span> <span class="nf">xmlExecuteRequestInputEnd</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:Data&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:Input&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">return</span> <span class="n">string</span>

</div>
<div class="viewcode-block" id="isMimeTypeVector"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.isMimeTypeVector">[docs]</a><span class="k">def</span> <span class="nf">isMimeTypeVector</span><span class="p">(</span><span class="n">mimeType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check for vector input. Zipped shapefiles must be extracted&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;WPS isMimeTypeVector:&quot;</span><span class="p">,</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">vectorType</span> <span class="ow">in</span> <span class="n">VECTOR_MIMETYPES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">vectorType</span><span class="p">[</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">vectorType</span><span class="p">[</span><span class="s">&quot;GDALID&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="isMimeTypeText"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.isMimeTypeText">[docs]</a><span class="k">def</span> <span class="nf">isMimeTypeText</span><span class="p">(</span><span class="n">mimeType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check for text file input&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;WPS isMimeTypeText:&quot;</span><span class="p">,</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;TEXT/PLAIN&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;TXT&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="isMimeTypeRaster"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.isMimeTypeRaster">[docs]</a><span class="k">def</span> <span class="nf">isMimeTypeRaster</span><span class="p">(</span><span class="n">mimeType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check for raster input&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;WPS isMimeTypeRaster:&quot;</span><span class="p">,</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rasterType</span> <span class="ow">in</span> <span class="n">RASTER_MIMETYPES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mimeType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">rasterType</span><span class="p">[</span><span class="s">&quot;MIMETYPE&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">rasterType</span><span class="p">[</span><span class="s">&quot;GDALID&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="WPS"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS">[docs]</a><span class="k">class</span> <span class="nc">WPS</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TODO: write doc string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Module</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="WPS.raiseError"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.raiseError">[docs]</a>    <span class="k">def</span> <span class="nf">raiseError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise a VisTrails error.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">traceback</span>
        <span class="k">if</span> <span class="n">traceback</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">ModuleError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="o">+</span> <span class="s">&#39;: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;fixed&quot; ports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInputFromPort</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">OGC_REQUEST_PORT</span><span class="p">)</span> <span class="c">#base URL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInputFromPort</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">OGC_POST_DATA_PORT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInputFromPort</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">WPS_PROCESS_PORT</span><span class="p">)</span> <span class="c">#name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">postString</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="c">#print &quot;\nWPS:165 PRIOR self.postString\n&quot;, self.postString, &quot;\n\n&quot;</span>
            <span class="c"># add input port details to POST request</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postString</span> <span class="o">=</span> \
                <span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">addInputsToPOST</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postString</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processID</span><span class="p">)</span>
            <span class="c">#print &quot;\nWPS:172 POST self.postString\n&quot;, self.postString, &quot;\n\n&quot;</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">WPS:173 POST len(self.postString)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postString</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span>
                <span class="n">outFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">home</span> <span class="o">+</span> <span class="s">&#39;/Desktop/wps_poststring&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
                <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postString</span><span class="p">)</span>
                <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            #TEST POST START</span>
<span class="sd">            self.url = &#39;http://ict4eo.meraka.csir.co.za/cgi-bin/wps.py&#39;</span>
<span class="sd">            self.postString = &#39;&#39;&#39;&lt;?xml version=&quot;1.0&quot; \</span>
<span class="sd">                              encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="sd">            &lt;wps:Execute service=&quot;WPS&quot; version=&quot;1.0.0&quot; \</span>
<span class="sd">                xmlns:wps=&quot;http://www.opengis.net/wps/1.0.0&quot;\</span>
<span class="sd">                xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot;\</span>
<span class="sd">                xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;\</span>
<span class="sd">                xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\</span>
<span class="sd">                xsi:schemaLocation=&quot;http://www.opengis.net/wps/1.0.0 \</span>
<span class="sd">                http://schemas.opengis.net/wps/1.0.0/wpsExecute_request.xsd&quot;&gt;</span>
<span class="sd">                &lt;ows:Identifier&gt;foo2&lt;/ows:Identifier&gt;</span>
<span class="sd">                &lt;wps:DataInputs&gt;</span>
<span class="sd">                    &lt;wps:Input&gt;</span>
<span class="sd">                        &lt;ows:Identifier&gt;data&lt;/ows:Identifier&gt;</span>
<span class="sd">                        &lt;ows:Title&gt;data&lt;/ows:Title&gt;</span>
<span class="sd">                        &lt;wps:Data&gt;</span>
<span class="sd">                            &lt;wps:ComplexData mimeType=&quot;text/xml&quot; schema=&quot;&quot; \</span>
<span class="sd">                                encoding=&quot;&quot;&gt;</span>
<span class="sd">                            &lt;ogr:FeatureCollection xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://schemas.opengis.net/gml/3.1.1/base/ gml.xsd&quot; xmlns:ogr=&quot;http://ogr.maptools.org/&quot; xmlns:gml=&quot;http://www.opengis.net/gml&quot;&gt;&lt;gml:boundedBy&gt;&lt;gml:Box&gt;&lt;gml:coord&gt;&lt;gml:X&gt;303314.4493983217&lt;/gml:X&gt;&lt;gml:Y&gt;6244549.021404636&lt;/gml:Y&gt;&lt;/gml:coord&gt;&lt;gml:coord&gt;&lt;gml:X&gt;303718.64560866&lt;/gml:X&gt;&lt;gml:Y&gt;6244692.545970687&lt;/gml:Y&gt;&lt;/gml:coord&gt;&lt;/gml:Box&gt;&lt;/gml:boundedBy&gt;&lt;gml:featureMember&gt;&lt;ogr:qt_temp fid=&quot;F0&quot;&gt;&lt;ogr:geometryProperty&gt;&lt;gml:Point&gt;&lt;gml:coordinates&gt;303314.449398321739864,6244692.545970686711371&lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&lt;/ogr:geometryProperty&gt;&lt;ogr:label&gt;gree&lt;/ogr:label&gt;&lt;ogr:id&gt;2323&lt;/ogr:id&gt;&lt;ogr:rotatation&gt;0&lt;/ogr:rotatation&gt;&lt;/ogr:qt_temp&gt;&lt;/gml:featureMember&gt;&lt;gml:featureMember&gt;&lt;ogr:qt_temp fid=&quot;F1&quot;&gt;&lt;ogr:geometryProperty&gt;&lt;gml:Point&gt;&lt;gml:coordinates&gt;303426.941625767154619,6244549.021404636092484&lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&lt;/ogr:geometryProperty&gt;&lt;ogr:label&gt;dwqdqwd&lt;/ogr:label&gt;&lt;ogr:id&gt;324324&lt;/ogr:id&gt;&lt;ogr:rotatation&gt;0&lt;/ogr:rotatation&gt;&lt;/ogr:qt_temp&gt;&lt;/gml:featureMember&gt;&lt;gml:featureMember&gt;&lt;ogr:qt_temp fid=&quot;F2&quot;&gt;&lt;ogr:geometryProperty&gt;&lt;gml:Point&gt;&lt;gml:coordinates&gt;303718.645608660008293,6244565.313382403925061&lt;/gml:coordinates&gt;&lt;/gml:Point&gt;&lt;/ogr:geometryProperty&gt;&lt;ogr:label&gt;nhfgh&lt;/ogr:label&gt;&lt;ogr:id&gt;34634&lt;/ogr:id&gt;&lt;ogr:rotatation&gt;0&lt;/ogr:rotatation&gt;&lt;/ogr:qt_temp&gt;&lt;/gml:featureMember&gt;&lt;/ogr:FeatureCollection&gt;&lt;/wps:ComplexData&gt;</span>
<span class="sd">                        &lt;/wps:Data&gt;</span>
<span class="sd">                    &lt;/wps:Input&gt;</span>
<span class="sd">                    &lt;wps:Input&gt;</span>
<span class="sd">                        &lt;ows:Identifier&gt;width&lt;/ows:Identifier&gt;</span>
<span class="sd">                        &lt;ows:Title&gt;width&lt;/ows:Title&gt;</span>
<span class="sd">                        &lt;wps:Data&gt;</span>
<span class="sd">                            &lt;wps:LiteralData&gt;10&lt;/wps:LiteralData&gt;</span>
<span class="sd">                        &lt;/wps:Data&gt;</span>
<span class="sd">                    &lt;/wps:Input&gt;</span>
<span class="sd">                &lt;/wps:DataInputs&gt;</span>
<span class="sd">                &lt;wps:ResponseForm&gt;</span>
<span class="sd">                    &lt;wps:ResponseDocument lineage=&quot;false&quot; storeExecuteResponse=&quot;true&quot; status=&quot;false&quot;&gt;</span>
<span class="sd">                        &lt;wps:Output&gt;</span>
<span class="sd">                            &lt;ows:Identifier&gt;text&lt;/ows:Identifier&gt;</span>
<span class="sd">                        &lt;/wps:Output&gt;</span>
<span class="sd">                        &lt;wps:Output asReference=&quot;true&quot; mimeType=&quot;text/xml&quot; schema=&quot;&quot;&gt;</span>
<span class="sd">                            &lt;ows:Identifier&gt;buffer&lt;/ows:Identifier&gt;</span>
<span class="sd">                        &lt;/wps:Output&gt;</span>
<span class="sd">                    &lt;/wps:ResponseDocument&gt;</span>
<span class="sd">                &lt;/wps:ResponseForm&gt;</span>
<span class="sd">            &lt;/wps:Execute&gt;&#39;&#39;&#39;</span>
<span class="sd">            #TEST POST END</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c"># connect to server</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">postString</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="c"># get the results back</span>
            <span class="n">wpsRequestResult</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c"># set the output ports</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultHandler</span><span class="p">(</span><span class="n">wpsRequestResult</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;Configuration Incomplete&#39;</span><span class="p">,</span>\
                            <span class="s">&#39;Unable to set URL and POST string&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="WPS.addInputsToPOST"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.addInputsToPOST">[docs]</a>    <span class="k">def</span> <span class="nf">addInputsToPOST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">postStringIn</span><span class="p">,</span> <span class="n">processID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert the input port data as part of the POST request.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">postStringIn</span><span class="p">:</span>
            <span class="c">#   iterate through static &amp; dynamic input ports and check for matching type</span>
            <span class="c">#   NB: self.inputPorts only shows &quot;template&quot; (fixed) ports UNLESS</span>
            <span class="c">#       the port is already hooked up to another pipeline input!</span>

            <span class="c"># TO DO - need find a better way to exclude &quot;static&quot; port from iterkeys() ???</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputPorts</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">init</span><span class="o">.</span><span class="n">OGC_REQUEST_PORT</span><span class="p">,</span> <span class="n">init</span><span class="o">.</span><span class="n">OGC_POST_DATA_PORT</span><span class="p">,</span> <span class="n">init</span><span class="o">.</span><span class="n">WPS_PROCESS_PORT</span><span class="p">]:</span>
                    <span class="c">#print &quot;244: key&quot;, key, self.inputPorts[key]</span>
                    <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputPorts</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">port_port</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">port</span>
                    <span class="n">port_object</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">obj</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="c">#print &quot;247: key:port_object&quot;, key, &quot;:&quot;, port_object, type(port_object)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_object</span><span class="p">,</span> <span class="n">QgsLayer</span><span class="o">.</span><span class="n">QgsVectorLayer</span><span class="p">):</span>
                        <span class="n">mimeType</span> <span class="o">=</span> <span class="s">&quot;text/xml&quot;</span>  <span class="c"># get from layer???</span>
                        <span class="n">schema</span> <span class="o">=</span> <span class="s">&quot;FOO&quot;</span>
                        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;FOO&quot;</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_object</span><span class="p">,</span> <span class="n">QgsLayer</span><span class="o">.</span><span class="n">QgsRasterLayer</span><span class="p">):</span>
                        <span class="n">mimeType</span> <span class="o">=</span> <span class="s">&quot;image/tiff&quot;</span>  <span class="c"># get from layer???</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c"># Handle layer input...</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_object</span><span class="p">,</span> <span class="n">QgsLayer</span><span class="o">.</span><span class="n">QgsVectorLayer</span><span class="p">)</span> <span class="ow">or</span> \
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_object</span><span class="p">,</span> <span class="n">QgsLayer</span><span class="o">.</span><span class="n">QgsRasterLayer</span><span class="p">):</span>
                        <span class="n">layer</span> <span class="o">=</span> <span class="n">port_object</span>
                        <span class="c"># start wrapper</span>
                        <span class="n">postString</span> <span class="o">=</span> <span class="n">xmlExecuteRequestInputStart</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
                        <span class="c"># check layer type</span>
                        <span class="k">if</span>  <span class="n">mimeType</span> <span class="o">==</span> <span class="s">&quot;text/xml&quot;</span><span class="p">:</span>
                            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:ComplexData mimeType=&quot;&#39;</span> <span class="o">+</span> <span class="n">mimeType</span> <span class="o">+</span>\
                                          <span class="s">&#39;&quot; schema=&quot;&#39;</span> <span class="o">+</span> <span class="n">schema</span> <span class="o">+</span> \
                                          <span class="s">&#39;&quot; encoding=&quot;&#39;</span> <span class="o">+</span> <span class="n">encoding</span> <span class="o">+</span> <span class="s">&#39;&quot;&gt;&#39;</span>
                            <span class="n">GML</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTmpGML</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">GML</span><span class="p">:</span>
                                <span class="n">postString</span> <span class="o">+=</span> <span class="n">GML</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;WPS Error&#39;</span><span class="p">,</span> <span class="s">&#39;Unable to encode vector to GML&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:ComplexData mimeType=&quot;&#39;</span> <span class="o">+</span> <span class="n">mimeType</span> <span class="o">+</span>\
                                          <span class="s">&#39;&quot; encoding=&quot;base64&quot;&gt;&#39;</span>
                            <span class="n">data64</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTmpBase64</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">data64</span><span class="p">:</span>
                                <span class="n">postString</span> <span class="o">+=</span> <span class="n">data64</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;WPS Error&#39;</span><span class="p">,</span> <span class="s">&#39;Unable to encode raster to base64&#39;</span><span class="p">)</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:ComplexData&gt;&quot;</span>
                        <span class="c"># end wrapper</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="n">xmlExecuteRequestInputEnd</span><span class="p">()</span>
                        <span class="c"># insert new XML into the existing POST string</span>
                        <span class="c"># NB: NO prefix on search node</span>
                        <span class="c">#print &quot;WPS:286 postString&quot;, postString</span>
                        <span class="n">postStringIn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertElement</span><span class="p">(</span>
                            <span class="n">postStringIn</span><span class="p">,</span>
                            <span class="n">postString</span><span class="p">,</span>
                            <span class="s">&#39;DataInputs&#39;</span><span class="p">,</span>
                            <span class="s">&#39;http://www.opengis.net/wps/1.0.0&#39;</span><span class="p">)</span>
                        <span class="c">#print &quot;WPS:290 postStringIn POST&quot;,postStringIn</span>
                        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                            <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span>
                            <span class="n">outFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">home</span> <span class="o">+</span> <span class="s">&#39;/Desktop/post_request.xml&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
                            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">postStringIn</span><span class="p">)</span>
                            <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                    <span class="c"># Handle string input</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_object</span><span class="p">,</span> <span class="n">String</span><span class="p">):</span>
                        <span class="c"># end wrapper</span>
                        <span class="n">postString</span> <span class="o">=</span> <span class="n">xmlExecuteRequestInputStart</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:LiteralData&gt;&#39;</span>
                        <span class="c">#bar = port_object.get_output(port_port) #see 454 in vistrails_module.py</span>
                        <span class="c">#print &quot;309:bar&quot;,key,type(bar),bar</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="n">port_object</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="n">port_port</span><span class="p">)</span> <span class="c">#string.get_output(&#39;value&#39;)</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;/wps:LiteralData&gt;&#39;</span>
                        <span class="c"># end wrapper</span>
                        <span class="n">postString</span> <span class="o">+=</span> <span class="n">xmlExecuteRequestInputEnd</span><span class="p">()</span>
                        <span class="c"># insert new XML into the existing POST string</span>
                        <span class="n">postStringIn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertElement</span><span class="p">(</span>
                            <span class="n">postStringIn</span><span class="p">,</span>
                            <span class="n">postString</span><span class="p">,</span>
                            <span class="s">&#39;DataInputs&#39;</span><span class="p">,</span>
                            <span class="s">&#39;http://www.opengis.net/wps/1.0.0&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;Configuration Incomplete&#39;</span><span class="p">,</span>\
                                <span class="s">&#39;Unable to handle port type for </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                ######### CODE THAT NEEDS TO BE ADAPTED TO ENHANCE THE ABOVE ##########</span>
<span class="sd">                if isMimeTypeVector(mimeType) != None and mimeType == &quot;text/xml&quot;:</span>
<span class="sd">                    postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; schema=\&quot;&quot; + schema + &quot;\&quot; encoding=\&quot;&quot; + encoding + &quot;\&quot;&gt;&quot;</span>
<span class="sd">                    postString += self.createTmpGML(listWidget.text(), useSelected).replace(&quot;&gt; &lt;&quot;, &quot;&gt;&lt;&quot;).replace(&quot;http://ogr.maptools.org/ qt_temp.xsd&quot;, &quot;http://ogr.maptools.org/qt_temp.xsd&quot;)</span>
<span class="sd">                elif isMimeTypeVector(mimeType) != None or isMimeTypeRaster(mimeType) != None:</span>
<span class="sd">                    postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; encoding=\&quot;base64\&quot;&gt;\n&quot;</span>
<span class="sd">                    postString += self.createTmpBase64(listWidget.text())</span>

<span class="sd">                postString += &quot;&lt;/wps:ComplexData&gt;\n&quot;</span>
<span class="sd">                postString += xmlExecuteRequestInputEnd()</span>

<span class="sd">                # Single raster and vector inputs</span>
<span class="sd">                for comboBox in self.complexInputComboBoxList:</span>
<span class="sd">                # Do not add undefined inputs</span>
<span class="sd">                    if comboBox == None or unicode(comboBox.currentText(), &#39;latin1&#39;) == &quot;&lt;None&gt;&quot;:</span>
<span class="sd">                        continue</span>

<span class="sd">                    postString += xmlExecuteRequestInputStart(comboBox.objectName())</span>

<span class="sd">                    # TODO: Check for more types</span>
<span class="sd">                    mimeType = self.inputDataTypeList[comboBox.objectName()][&quot;MimeType&quot;]</span>
<span class="sd">                    schema = self.inputDataTypeList[comboBox.objectName()][&quot;Schema&quot;]</span>
<span class="sd">                    encoding = self.inputDataTypeList[comboBox.objectName()][&quot;Encoding&quot;]</span>

<span class="sd">                    if isMimeTypeVector(mimeType) != None and mimeType == &quot;text/xml&quot;:</span>
<span class="sd">                        postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; schema=\&quot;&quot; + schema + &quot;\&quot; encoding=\&quot;&quot; + encoding + &quot;\&quot;&gt;&quot;</span>
<span class="sd">                        postString += self.createTmpGML(comboBox.currentText(), useSelected).replace(&quot;&gt; &lt;&quot;, &quot;&gt;&lt;&quot;)</span>
<span class="sd">                        postString = postString.replace(&quot;xsi:schemaLocation=\&quot;http://ogr.maptools.org/ qt_temp.xsd\&quot;&quot;, &quot;xsi:schemaLocation=\&quot;http://schemas.opengis.net/gml/3.1.1/base/ gml.xsd\&quot;&quot;)</span>
<span class="sd">                    elif isMimeTypeVector(mimeType) != None or isMimeTypeRaster(mimeType) != None:</span>
<span class="sd">                        postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; encoding=\&quot;base64\&quot;&gt;\n&quot;</span>
<span class="sd">                        postString += self.createTmpBase64(comboBox.currentText())</span>

<span class="sd">                    postString += &quot;&lt;/wps:ComplexData&gt;\n&quot;</span>
<span class="sd">                    postString += xmlExecuteRequestInputEnd()</span>

<span class="sd">                # Multiple raster and vector inputs</span>
<span class="sd">                for listWidgets in self.complexInputListWidgetList:</span>
<span class="sd">                # Do not add undefined inputs</span>
<span class="sd">                    if listWidgets == None:</span>
<span class="sd">                        continue</span>

<span class="sd">                    mimeType = self.inputDataTypeList[listWidgets.objectName()][&quot;MimeType&quot;]</span>
<span class="sd">                    schema = self.inputDataTypeList[listWidgets.objectName()][&quot;Schema&quot;]</span>
<span class="sd">                    encoding = self.inputDataTypeList[listWidgets.objectName()][&quot;Encoding&quot;]</span>

<span class="sd">                # Iterate over each selected item</span>
<span class="sd">                for i in range(listWidgets.count()):</span>
<span class="sd">                    listWidget = listWidgets.item(i)</span>
<span class="sd">                    if listWidget == None or listWidget.isSelected() == False or str(listWidget.text()) == &quot;&lt;None&gt;&quot;:</span>
<span class="sd">                        continue</span>

<span class="sd">                    postString += xmlExecuteRequestInputStart(listWidgets.objectName())</span>

<span class="sd">                    # TODO: Check for more types</span>
<span class="sd">                    if isMimeTypeVector(mimeType) != None and mimeType == &quot;text/xml&quot;:</span>
<span class="sd">                        postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; schema=\&quot;&quot; + schema + &quot;\&quot; encoding=\&quot;&quot; + encoding + &quot;\&quot;&gt;&quot;</span>
<span class="sd">                        postString += self.createTmpGML(listWidget.text(), useSelected).replace(&quot;&gt; &lt;&quot;, &quot;&gt;&lt;&quot;).replace(&quot;http://ogr.maptools.org/ qt_temp.xsd&quot;, &quot;http://ogr.maptools.org/qt_temp.xsd&quot;)</span>
<span class="sd">                    elif isMimeTypeVector(mimeType) != None or isMimeTypeRaster(mimeType) != None:</span>
<span class="sd">                        postString += &quot;&lt;wps:ComplexData mimeType=\&quot;&quot; + mimeType + &quot;\&quot; encoding=\&quot;base64\&quot;&gt;\n&quot;</span>
<span class="sd">                        postString += self.createTmpBase64(listWidget.text())</span>

<span class="sd">                    postString += &quot;&lt;/wps:ComplexData&gt;\n&quot;</span>
<span class="sd">                    postString += xmlExecuteRequestInputEnd()</span>
<span class="sd">                &quot;&quot;&quot;</span>

        <span class="c">#print &quot;WPS:365&quot;,postStringIn</span>
        <span class="k">return</span> <span class="n">postStringIn</span>
</div>
<div class="viewcode-block" id="WPS.resultHandler"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.resultHandler">[docs]</a>    <span class="k">def</span> <span class="nf">resultHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultXML</span><span class="p">,</span> <span class="n">resultType</span><span class="o">=</span><span class="s">&quot;store&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle the result of the WPS Execute request and add the outputs to</span>
<span class="sd">        the appropriate ports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">QtXml</span><span class="o">.</span><span class="n">QDomDocument</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">setContent</span><span class="p">(</span><span class="n">resultXML</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">resultNodeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;Output&quot;</span><span class="p">)</span>

        <span class="c"># TODO: Check if the process does not run correctly before</span>
        <span class="k">if</span> <span class="n">resultNodeList</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resultNodeList</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">f_element</span> <span class="o">=</span> <span class="n">resultNodeList</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>

                <span class="c"># Fetch the referenced complex data</span>
                <span class="k">if</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;Reference&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
                        <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Identifier&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
                    <span class="n">reference</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
                        <span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;Reference&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>

                    <span class="c"># Get the reference</span>
                    <span class="n">fileLink</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;href&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>

                    <span class="c"># Try with namespace if not successful</span>
                    <span class="k">if</span> <span class="n">fileLink</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                        <span class="n">fileLink</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">attributeNS</span><span class="p">(</span>
                            <span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span><span class="p">,</span> <span class="s">&quot;href&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fileLink</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
                            <span class="s">&quot;WPS Error: Unable to download the result of reference: &quot;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileLink</span><span class="p">))</span>
                        <span class="k">return</span>

                    <span class="c"># Get the mime type of the result</span>
                    <span class="n">mimeType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;mimeType&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toLower</span><span class="p">())</span>

                    <span class="k">if</span> <span class="n">fileLink</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                        <span class="c"># Set a valid layerName</span>
                        <span class="n">layerName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqueLayerName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
                        <span class="c"># Layer filename</span>
                        <span class="n">resultFileConnector</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">fileLink</span><span class="p">,</span> <span class="s">&#39;latin1&#39;</span><span class="p">))</span>
                        <span class="n">resultFile</span> <span class="o">=</span> <span class="n">resultFileConnector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c"># Vector data</span>
                        <span class="c"># TODO: Check for schema GML and KML</span>
                        <span class="k">if</span> <span class="n">isMimeTypeVector</span><span class="p">(</span><span class="n">mimeType</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">resultFile</span><span class="p">,</span> <span class="n">layerName</span><span class="p">,</span> <span class="s">&quot;ogr&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setResult</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">MAP_LAYER_PORT</span><span class="p">,</span> <span class="n">vlayer</span><span class="p">)</span>
                        <span class="c"># Raster data</span>
                        <span class="k">elif</span> <span class="n">isMimeTypeRaster</span><span class="p">(</span><span class="n">mimeType</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="c"># We can directly attach the new layer</span>
                            <span class="n">rLayer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">resultFile</span><span class="p">,</span> <span class="n">layerName</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setResult</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">MAP_LAYER_PORT</span><span class="p">,</span> <span class="n">rLayer</span><span class="p">)</span>
                        <span class="c"># Text data</span>
                        <span class="k">elif</span> <span class="n">isMimeTypeText</span><span class="p">(</span><span class="n">mimeType</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">resultFile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setResult</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">DATA_RESULT_PORT</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                        <span class="c"># Everything else</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c"># For unsupported mime types we assume text</span>
                            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                                <span class="k">print</span> <span class="s">&quot;WARNING - result is not a defined MIME type&quot;</span>
                            <span class="n">content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">resultFile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setResult</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">DATA_RESULT_PORT</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;LiteralData&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">literalText</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;LiteralData&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="c"># TODO: how to handle this ?</span>
                    <span class="c">#self.popUpMessageBox(QCoreApplication.translate(&quot;QgsWps&quot;, &#39;Result&#39;),literalText)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span>
                        <span class="s">&quot;WPS Error&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Missing Reference tag, or literal data, in response XML&quot;</span><span class="p">)</span>

            <span class="c"># TODO: how to handle this ?</span>
            <span class="c">#QMessageBox.information(None, QCoreApplication.translate(&quot;QgsWps&quot;, &#39;Process result&#39;), QCoreApplication.translate(&quot;QgsWps&quot;, &#39;The process finished successful&#39;))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errorHandler</span><span class="p">(</span><span class="n">resultXML</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPS.createTmpGML"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.createTmpGML">[docs]</a>    <span class="k">def</span> <span class="nf">createTmpGML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vLayer</span><span class="p">,</span> <span class="n">processSelection</span><span class="o">=</span><span class="s">&quot;False&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string</span>

<span class="sd">        * vLayer is an actual QGIS vector layer (not a string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">myQTempFile</span> <span class="o">=</span> <span class="n">QTemporaryFile</span><span class="p">()</span>
        <span class="n">myQTempFile</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="n">tmpFile</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">myQTempFile</span><span class="o">.</span><span class="n">fileName</span><span class="p">(),</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;postgres&quot;</span><span class="p">:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDBEncoding</span><span class="p">(</span><span class="n">vLayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">encoding</span><span class="p">()</span>

        <span class="n">fieldList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFieldList</span><span class="p">(</span><span class="n">vLayer</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createGMLFileWriter</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="n">fieldList</span><span class="p">,</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">geometryType</span><span class="p">(),</span> <span class="n">encoding</span><span class="p">)</span>

        <span class="c"># error = QgsVectorFileWriter.writeAsShapefile(layer, &quot;my_shapes.shp&quot;, &quot;CP1250&quot;)</span>
        <span class="c">#print &quot;WPS:466 TEMP-GML-File Name: &quot; + tmpFile</span>
        <span class="n">provider</span> <span class="o">=</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
        <span class="n">allAttrs</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">attributeIndexes</span><span class="p">()</span>
        <span class="n">provider</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">allAttrs</span><span class="p">)</span>
        <span class="n">featureList</span> <span class="o">=</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">selectedFeatures</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">processSelection</span> <span class="ow">and</span> <span class="n">vLayer</span><span class="o">.</span><span class="n">selectedFeatureCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">featureList</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">provider</span><span class="o">.</span><span class="n">nextFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">):</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">writer</span>

        <span class="n">myFile</span> <span class="o">=</span> <span class="n">QFile</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">myFile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">QIODevice</span><span class="o">.</span><span class="n">ReadOnly</span> <span class="o">|</span> <span class="n">QIODevice</span><span class="o">.</span><span class="n">Text</span><span class="p">)):</span>
            <span class="k">pass</span>

        <span class="n">myGML</span> <span class="o">=</span> <span class="n">QTextStream</span><span class="p">(</span><span class="n">myFile</span><span class="p">)</span>
        <span class="n">gmlString</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="c"># Overread the first Line of GML Result</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">myGML</span><span class="o">.</span><span class="n">readLine</span><span class="p">()</span>
        <span class="n">gmlString</span> <span class="o">+=</span> <span class="n">myGML</span><span class="o">.</span><span class="n">readAll</span><span class="p">()</span>
        <span class="n">myFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">myQTempFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gmlString</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPS.createTmpBase64"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.createTmpBase64">[docs]</a>    <span class="k">def</span> <span class="nf">createTmpBase64</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rLayer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Encode raster data to base64 format, for use in XML POST string.</span>

<span class="sd">        * rLayer is an actual QGIS raster layer (not a string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">base64</span>
        <span class="c"># disk-based approach with file manipulation</span>
        <span class="n">base64String</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">layer_source</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rLayer</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
        <span class="c">#try:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;base64&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&quot;http://&quot;</span> <span class="ow">in</span> <span class="n">rLayer</span><span class="o">.</span><span class="n">source</span><span class="p">():</span> <span class="c">#TODO: better test than this !!!</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">layer_source</span><span class="p">)</span> <span class="c"># read from web</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">layer_source</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="c"># read from disk</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">base64</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">base64String</span> <span class="o">=</span> <span class="n">outfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c">#except:</span>
        <span class="c">#    QMessageBox.warning(None, &#39;&#39;, &quot;Unable to create temporary file: &quot; + filename + &quot; for base64 encoding&quot;)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        base64String = base64.encodestring(rLayer) # error: no len() for rLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">base64String</span>
</div>
<div class="viewcode-block" id="WPS.errorHandler"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.errorHandler">[docs]</a>    <span class="k">def</span> <span class="nf">errorHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultXML</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format the error message from the WPS.&quot;&quot;&quot;</span>
        <span class="n">errorDoc</span> <span class="o">=</span> <span class="n">QtXml</span><span class="o">.</span><span class="n">QDomDocument</span><span class="p">()</span>
        <span class="n">myResult</span> <span class="o">=</span> <span class="n">errorDoc</span><span class="o">.</span><span class="n">setContent</span><span class="p">(</span><span class="n">resultXML</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>

        <span class="n">resultExceptionNodeList</span> <span class="o">=</span> <span class="n">errorDoc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;ExceptionReport&quot;</span><span class="p">)</span>
        <span class="n">exceptionText</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">resultElement</span> <span class="o">=</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">exceptionText</span> <span class="o">+=</span> <span class="n">resultElement</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">resultExceptionNodeList</span> <span class="o">=</span> <span class="n">errorDoc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;ExceptionText&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">resultElement</span> <span class="o">=</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">exceptionText</span> <span class="o">+=</span> <span class="n">resultElement</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">resultExceptionNodeList</span> <span class="o">=</span> <span class="n">errorDoc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;ExceptionText&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">resultElement</span> <span class="o">=</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">exceptionText</span> <span class="o">+=</span> <span class="n">resultElement</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">resultExceptionNodeList</span> <span class="o">=</span> <span class="n">errorDoc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Exception&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="n">resultElement</span> <span class="o">=</span> <span class="n">resultExceptionNodeList</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">exceptionText</span> <span class="o">+=</span> <span class="n">resultElement</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;exceptionCode&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exceptionText</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="n">resultXML</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPS.createGMLFileWriter"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.createGMLFileWriter">[docs]</a>    <span class="k">def</span> <span class="nf">createGMLFileWriter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">myTempFile</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">geometryType</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="p">(</span>
            <span class="n">myTempFile</span><span class="p">,</span>
            <span class="n">encoding</span><span class="p">,</span>
            <span class="n">fields</span><span class="p">,</span>
            <span class="n">geometryType</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;GML&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">writer</span><span class="o">.</span><span class="n">hasError</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">NoError</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writerErrorMessage</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">hasError</span><span class="p">())</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">writer</span>
</div>
<div class="viewcode-block" id="WPS.getFieldList"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.getFieldList">[docs]</a>    <span class="k">def</span> <span class="nf">getFieldList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vlayer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the Llist of Fields</span>
<span class="sd">        Return: QGsFieldMap&quot;&quot;&quot;</span>
        <span class="n">fProvider</span> <span class="o">=</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
        <span class="n">allAttrs</span> <span class="o">=</span> <span class="n">fProvider</span><span class="o">.</span><span class="n">attributeIndexes</span><span class="p">()</span>
        <span class="c"># start data retrieval: all attributes for each feature</span>
        <span class="n">fProvider</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">allAttrs</span><span class="p">,</span> <span class="n">QgsRectangle</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="c"># retrieve every feature with its attributes</span>
        <span class="n">myFields</span> <span class="o">=</span> <span class="n">fProvider</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">myFields</span>
</div>
<div class="viewcode-block" id="WPS.insertElement"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.insertElement">[docs]</a>    <span class="k">def</span> <span class="nf">insertElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return updated source with element inserted at a specified node.</span>

<span class="sd">        All items must arrive as strings; result is also a string&quot;&quot;&quot;</span>
        <span class="c">#print &quot;\nWPS:592 insertElement:\n **Source**&quot;, source, &quot;\n**Element**&quot;,element, &quot;\n**node**&quot;, node</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">xml</span>
                    <span class="kn">from</span> <span class="nn">xml.parsers.expat</span> <span class="kn">import</span> <span class="n">ExpatError</span>
                    <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="s">&quot;{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">doc</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;.//&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">target</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">target</span> <span class="o">=</span> <span class="n">result</span>
                            <span class="c">#print &quot;WPS:630\n&quot;, element</span>
                            <span class="n">new_element</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                            <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">xml</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">ExpatError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&quot;Expat Error&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Unable to create XML elements from input data.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raiseError</span><span class="p">(</span><span class="s">&quot;WPS insertElement Error&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Cannot use a &#39;:&#39; in an element name.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source</span>
</div>
<div class="viewcode-block" id="WPS.uniqueLayerName"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPS.uniqueLayerName">[docs]</a>    <span class="k">def</span> <span class="nf">uniqueLayerName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: Check the output ports and assign unique name to output layer</span>
<span class="sd">        We need to discuss how to go about this&quot;&quot;&quot;</span>
        <span class="c">#print &#39;WPS:622 output layer&#39;</span>
        <span class="n">mapLayers</span> <span class="o">=</span> <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">mapLayers</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">layerNameList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mapLayers</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">layerNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="n">layerNameList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="n">layerNameList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layerName</span> <span class="o">==</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">unicode</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&#39;latin1&#39;</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">unicode</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newName</span>

</div></div>
<div class="viewcode-block" id="WPSConfigurationWidget"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget">[docs]</a><span class="k">class</span> <span class="nc">WPSConfigurationWidget</span><span class="p">(</span><span class="n">PortConfigurationWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; UntupleConfigurationWidget(module: Module,</span>
<span class="sd">                                     controller: VistrailController,</span>
<span class="sd">                                     parent: QWidget)</span>
<span class="sd">                                     -&gt; UntupleConfigurationWidget</span>
<span class="sd">        Let StandardModuleConfigurationWidget constructor store the</span>
<span class="sd">        controller/module object from the builder and set up the</span>
<span class="sd">        configuration widget.</span>
<span class="sd">        After StandardModuleConfigurationWidget constructor, all of</span>
<span class="sd">        these will be available:</span>
<span class="sd">        * self.module : the Module object into the pipeline</span>
<span class="sd">        * self.module_descriptor: the descriptor for the type in the registry</span>
<span class="sd">        * self.controller: the current vistrail controller</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PortConfigurationWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span>
                                        <span class="n">controller</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s">&quot;WpsConfigWidget&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_config_window</span><span class="p">()</span>

<div class="viewcode-block" id="WPSConfigurationWidget.create_config_window"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.create_config_window">[docs]</a>    <span class="k">def</span> <span class="nf">create_config_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create Qt elements for the configuration dialog</span>
<span class="sd">        * hook buttons to methods</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s">&quot;OGC WPS Configuration Widget&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowModal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">593</span><span class="p">,</span> <span class="mi">442</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GroupBox1</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s">&quot;Server Connections&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GroupBox1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="n">spacerItem</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">171</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacerItem</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GroupBox1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s">&quot;btnConnect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Connect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c">#at runtime will be parsing a url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s">&#39;WPS URL:&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URLConnect</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="n">DEFAULT_URL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URLConnect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="c">#sets it not to be editable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">URLConnect</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s">&#39;WPS Version:&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s">&#39;1.0.0&#39;</span><span class="p">,</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># tabs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabService</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabProcess</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabProcessLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabProcess</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabServiceLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabService</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabService</span><span class="p">,</span> <span class="s">&quot;Process &amp;List&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabProcess</span><span class="p">,</span> <span class="s">&quot;Process &amp;Inputs/Outputs&quot;</span><span class="p">)</span>

        <span class="c"># service tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span> <span class="o">=</span> <span class="n">QTreeWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s">&quot;treeWidget&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Identifier&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Title&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c"># column, order (0=ASC)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="c"># only wraps at linebreaks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabServiceLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="p">)</span>

        <span class="c"># process tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span> <span class="o">=</span> <span class="n">QTreeWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s">&quot;treeWidget&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;In/Out&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Identifier&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;MIME Type&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Title&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c"># column, order (0=ASC)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="c"># only wraps at linebreaks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabProcessLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c">#spacerItem1 = QSpacerItem(10, 10, QSizePolicy.Expanding, QSizePolicy.Minimum)</span>
        <span class="c">#self.mainLayout.addItem(spacerItem1, 5, 2, 1, 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonLayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">)</span>
        <span class="c">#self.buttonLayout.setGeometry(QtCore.QRect(300, 500, 780, 680))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonLayout</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonLayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s">&#39;&amp;Cancel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s">&#39;Esc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnOk</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s">&#39;&amp;OK&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnOk</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnOk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#self.layout().addLayout(self.buttonLayout)</span>

        <span class="c"># Connect button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnConnect</span><span class="p">,</span>
            <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;clicked(bool)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectServer</span><span class="p">)</span>
        <span class="c"># OK button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnOk</span><span class="p">,</span>
            <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;clicked(bool)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnOK_clicked</span><span class="p">)</span>
        <span class="c"># Cancel Button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="p">,</span>
            <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;clicked(bool)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="c"># Tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="p">,</span>
            <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;currentChanged(int)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showProcess</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.connectServer"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.connectServer">[docs]</a>    <span class="k">def</span> <span class="nf">connectServer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add items to treeWidget</span>
<span class="sd">        see qgswps.py:: createCapabilities Gui&quot;&quot;&quot;</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">URLConnect</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="c"># pass version here</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">webConnectionExists</span><span class="p">(</span><span class="n">connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">itemListAll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCapabilities</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initTreeWPSServices</span><span class="p">(</span><span class="n">itemListAll</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.showProcess"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.showProcess">[docs]</a>    <span class="k">def</span> <span class="nf">showProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display process details when process details tab selected.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selected_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProcessDescription</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">displayProcessDescription</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.webConnectionExists"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.webConnectionExists">[docs]</a>    <span class="k">def</span> <span class="nf">webConnectionExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if server returns GetCapabilities as XML&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServiceXML</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s">&quot;GetCapabilities&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Web Connection Failed&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getServiceXML"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getServiceXML">[docs]</a>    <span class="k">def</span> <span class="nf">getServiceXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get server and connection details from Stored Server Connections</span>
<span class="sd">        Param: String ConnectionName</span>
<span class="sd">        Return: Array Server Information</span>
<span class="sd">            (http,www....,/cgi-bin/...,Post||Get,Service Version)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServer</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;method&quot;</span><span class="p">]</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">myRequest</span> <span class="o">=</span> <span class="s">&quot;?Request=&quot;</span> <span class="o">+</span> <span class="n">request</span> <span class="o">+</span> <span class="s">&quot;&amp;identifier=&quot;</span> <span class="o">+</span> \
                        <span class="n">identifier</span> <span class="o">+</span> <span class="s">&quot;&amp;Service=WPS&amp;Version=&quot;</span> <span class="o">+</span> <span class="n">version</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myRequest</span> <span class="o">=</span> <span class="s">&quot;?Request=&quot;</span> <span class="o">+</span> <span class="n">request</span> <span class="o">+</span> <span class="s">&quot;&amp;Service=WPS&amp;Version=&quot;</span> <span class="o">+</span>\
                        <span class="n">version</span>

        <span class="n">myPath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">myRequest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbindung</span> <span class="o">=</span> <span class="n">HTTPConnection</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">server</span><span class="p">))</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbindung</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">myPath</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbindung</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getServer"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getServer">[docs]</a>    <span class="k">def</span> <span class="nf">getServer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return server details as a dictionary&quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span>
        <span class="n">myURL</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">mySettings</span> <span class="o">=</span> <span class="s">&quot;/WPS/&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">mySettings</span> <span class="o">+</span> <span class="s">&quot;/method&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;scheme&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myURL</span><span class="o">.</span><span class="n">scheme</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myURL</span><span class="o">.</span><span class="n">netloc</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myURL</span><span class="o">.</span><span class="n">path</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">mySettings</span> <span class="o">+</span> <span class="s">&quot;/method&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getCapabilities"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getCapabilities">[docs]</a>    <span class="k">def</span> <span class="nf">getCapabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Qt list of core metadata from WPS GetCapabilities request&quot;&quot;&quot;</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServiceXML</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s">&quot;GetCapabilities&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">QtXml</span><span class="o">.</span><span class="n">QDomDocument</span><span class="p">()</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">setContent</span><span class="p">(</span><span class="n">xmlString</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="c">#test parsing of xml doc</span>
        <span class="k">if</span> <span class="n">DEBUG</span> <span class="ow">and</span> <span class="n">test</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;WPS: XML document parsed&#39;</span>
        <span class="c">#check version - only handle 1.0.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServiceVersion</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Error&#39;</span><span class="p">,</span> <span class="s">&#39;Only WPS Version 1.0.0 is supported&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c">#key metadata for capabilities</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;Process&quot;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Title&quot;</span><span class="p">)</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Identifier&quot;</span><span class="p">)</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span>
        <span class="c">#store key data in Qt list</span>
        <span class="n">itemListAll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">version</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">v_element</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">i_element</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">t_element</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">a_element</span> <span class="o">=</span> <span class="n">abstract</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_element</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_element</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_element</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">itemListAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">itemListAll</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getServiceVersion"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getServiceVersion">[docs]</a>    <span class="k">def</span> <span class="nf">getServiceVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return WPS Version&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">launchversion</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.initTreeWPSServices"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.initTreeWPSServices">[docs]</a>    <span class="k">def</span> <span class="nf">initTreeWPSServices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taglist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">columnCount</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">taglist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span>
            <span class="n">abstract</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ident</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">abstract</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">addTopLevelItems</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getProcessDescription"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getProcessDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getProcessDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get and store the selected process meta-data&quot;&quot;&quot;</span>
        <span class="c"># Process identifier</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">URLConnect</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetService</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s">&quot;WPS&quot;</span><span class="p">,</span> <span class="s">&#39;Please select a Process&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># Data Storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputsMetaInfo</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># input metainfo, key is input identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputsMetaInfo</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># output metainfo, key is output identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputDataTypeList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputDataTypeList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Receive the XML process description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processName</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pDoc</span> <span class="o">=</span> <span class="n">QtXml</span><span class="o">.</span><span class="n">QDomDocument</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pDoc</span><span class="o">.</span><span class="n">setContent</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getServiceXML</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processName</span><span class="p">,</span>
                <span class="s">&quot;DescribeProcess&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span><span class="p">),</span>
            <span class="bp">True</span><span class="p">)</span>
        <span class="c"># Process description attributes</span>
        <span class="n">process_attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pDoc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;ProcessDescription&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processAttributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProcessAttributes</span><span class="p">(</span><span class="n">process_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataInputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pDoc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataOutputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pDoc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Output&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Process &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &amp;Inputs/Outputs&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.displayProcessDescription"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.displayProcessDescription">[docs]</a>    <span class="k">def</span> <span class="nf">displayProcessDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use treeWidgetProcess to display the selected process details.&quot;&quot;&quot;</span>
        <span class="c"># Setup Qt list</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Get Descriptions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataOutputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">f_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataOutputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">identifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="n">f_element</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Output&quot;</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mime_type</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataInputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">f_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataInputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">identifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="n">f_element</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Input&quot;</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mime_type</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="c"># Add to tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeWidgetProcess</span><span class="o">.</span><span class="n">addTopLevelItems</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.btnOK_clicked"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.btnOK_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">btnOK_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create dynamic ports based on process description.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getProcessDescription</span><span class="p">()</span>
        <span class="c"># Generate the ports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateProcessInputPorts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataInputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateProcessOutputPorts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataOutputs</span><span class="p">)</span>
        <span class="c"># Update VisTrails with new port details for module</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateVistrail</span><span class="p">():</span>  <span class="c"># PortConfigurationWidget</span>
            <span class="c"># set default port info (request, processID etc)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getProcessInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;doneConfigure()&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getProcessAttributes"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getProcessAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">getProcessAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary containing process description attributes&quot;&quot;&quot;</span>
        <span class="n">f_element</span> <span class="o">=</span> <span class="n">process_attr</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">f_element</span><span class="p">:</span>
            <span class="n">processVersion</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;processVersion&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
            <span class="n">storeSupported</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;storeSupported&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;false&#39;</span>
            <span class="n">statusSupported</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;statusSupported&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;false&#39;</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">processVersion</span><span class="p">),</span>
                <span class="s">&#39;store&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">storeSupported</span><span class="p">),</span>
                <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">statusSupported</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.generateProcessInputPorts"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.generateProcessInputPorts">[docs]</a>    <span class="k">def</span> <span class="nf">generateProcessInputPorts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DataInputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the ports for all inputs defined in process description</span>
<span class="sd">        XML file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Create the complex inputs at first</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DataInputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">f_element</span> <span class="o">=</span> <span class="n">DataInputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="n">f_element</span><span class="p">)</span>
            <span class="n">complexData</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;ComplexData&quot;</span><span class="p">)</span>
            <span class="n">minOccurs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;minOccurs&quot;</span><span class="p">))</span>
            <span class="n">maxOccurs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;maxOccurs&quot;</span><span class="p">))</span>

            <span class="c"># Iterate over complex inputs and add combo boxes, text boxes or list widgets</span>
            <span class="k">if</span> <span class="n">complexData</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Das i-te ComplexData Objekt auswerten</span>
                <span class="n">complexDataTypeElement</span> <span class="o">=</span> <span class="n">complexData</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">complexDataFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultMimeType</span><span class="p">(</span><span class="n">complexDataTypeElement</span><span class="p">)</span>
                <span class="n">supportedComplexDataFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">(</span><span class="n">complexDataTypeElement</span><span class="p">)</span>
                <span class="c"># Store the input formats</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputsMetaInfo</span><span class="p">[</span><span class="n">inputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">supportedComplexDataFormat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputDataTypeList</span><span class="p">[</span><span class="n">inputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexDataFormat</span>
                <span class="c">#print &quot;WPS:1045 Input Port #&quot;, i, inputIdentifier, title, str(complexDataFormat)</span>
                <span class="c"># Attach the selected vector or raster maps</span>
                <span class="k">if</span> <span class="n">isMimeTypeVector</span><span class="p">(</span><span class="n">complexDataFormat</span><span class="p">[</span><span class="s">&quot;MimeType&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Vector inputs</span>
                    <span class="k">if</span> <span class="n">maxOccurs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="n">sigstring</span><span class="o">=</span><span class="n">MAP_LAYER</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                <span class="k">elif</span> <span class="n">isMimeTypeText</span><span class="p">(</span><span class="n">complexDataFormat</span><span class="p">[</span><span class="s">&quot;MimeType&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="n">sigstring</span><span class="o">=</span><span class="n">MAP_LAYER</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                <span class="k">elif</span> <span class="n">isMimeTypeRaster</span><span class="p">(</span><span class="n">complexDataFormat</span><span class="p">[</span><span class="s">&quot;MimeType&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># Raster inputs</span>
                    <span class="k">if</span> <span class="n">maxOccurs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="n">sigstring</span><span class="o">=</span><span class="n">MAP_LAYER</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="n">sigstring</span><span class="o">=</span><span class="n">MAP_LAYER</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># We assume text inputs in case of an unknown mime type</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>

        <span class="c"># Create the literal inputs as second</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DataInputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">f_element</span> <span class="o">=</span> <span class="n">DataInputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="n">f_element</span><span class="p">)</span>
            <span class="n">literalData</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;LiteralData&quot;</span><span class="p">)</span>
            <span class="n">minOccurs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;minOccurs&quot;</span><span class="p">))</span>
            <span class="n">maxOccurs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f_element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&quot;maxOccurs&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">literalData</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">allowedValuesElement</span> <span class="o">=</span> <span class="n">literalData</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">aValues</span> <span class="o">=</span> <span class="n">allowedValuesElement</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
                    <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;AllowedValues&quot;</span><span class="p">)</span>
                <span class="n">dValue</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">allowedValuesElement</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span>
                    <span class="s">&quot;DefaultValue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="c">#print &quot;WPS:945 Checking allowed values &quot; + str(aValues.size())</span>
                <span class="k">if</span> <span class="n">aValues</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">valList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowedValues</span><span class="p">(</span><span class="n">aValues</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># PortConfigurationWidget</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # At last, create the bounding box inputs</span>
<span class="sd">        for i in range(DataInputs.size()):</span>
<span class="sd">            f_element = DataInputs.at(i).toElement()</span>
<span class="sd">            inputIdentifier, title, abstract = self.getIdentifierTitleAbstractFromElement(f_element)</span>

<span class="sd">            #port = Port(id=inputIdentifier, name=title, type=&#39;input&#39;)</span>
<span class="sd">            #self.addPort(port)  # PortConfigurationWidget</span>


<span class="sd">            bBoxData = f_element.elementsByTagName(&quot;BoundingBoxData&quot;)</span>
<span class="sd">            minOccurs = int(f_element.attribute(&quot;minOccurs&quot;))</span>
<span class="sd">            maxOccurs = int(f_element.attribute(&quot;maxOccurs&quot;))</span>

<span class="sd">            if bBoxData.size() &gt; 0:</span>
<span class="sd">                crsListe = []</span>
<span class="sd">                bBoxElement = bBoxData.at(0).toElement()</span>
<span class="sd">                defaultCrsElement = bBoxElement.elementsByTagName(&quot;Default&quot;).at(0).toElement()</span>
<span class="sd">                defaultCrs = defaultCrsElement.elementsByTagName(&quot;CRS&quot;).at(0).toElement().attributeNS(</span>
<span class="sd">                    &quot;http://www.w3.org/1999/xlink&quot;, &quot;href&quot;)</span>
<span class="sd">                crsListe.append(defaultCrs)</span>
<span class="sd">                self.addLiteralLineEdit(</span>
<span class="sd">                    title + &quot;(minx, miny, maxx, maxy)&quot;,</span>
<span class="sd">                    inputIdentifier,</span>
<span class="sd">                    minOccurs)</span>

<span class="sd">                supportedCrsElements = bBoxElement.elementsByTagName(&quot;Supported&quot;)</span>

<span class="sd">                for i in range(supportedCrsElements.size()):</span>
<span class="sd">                    crsListe.append(</span>
<span class="sd">                        supportedCrsElements.at(i).toElement().elementsByTagName(&quot;CRS&quot;).at(0).toElement().attributeNS(&quot;http://www.w3.org/1999/xlink&quot;, &quot;href&quot;))</span>
<span class="sd">                    self.literalInputComboBoxList.append(self.addLiteralComboBox(</span>
<span class="sd">                        &quot;Supported CRS&quot;, inputIdentifier, crsListe, minOccurs))</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.generateProcessOutputPorts"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.generateProcessOutputPorts">[docs]</a>    <span class="k">def</span> <span class="nf">generateProcessOutputPorts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DataOutputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the ports for all inputs defined in process description</span>
<span class="sd">        XML file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">DataOutputs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># Add all outputs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DataOutputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">f_element</span> <span class="o">=</span> <span class="n">DataOutputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">outputIdentifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="n">f_element</span><span class="p">)</span>

            <span class="c"># Iterate over all complex outputs</span>
            <span class="n">complexOutput</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;ComplexOutput&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">complexOutput</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Das i-te ComplexData Objekt auswerten</span>
                <span class="n">complexOutputTypeElement</span> <span class="o">=</span> <span class="n">complexOutput</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">complexOutputFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultMimeType</span><span class="p">(</span><span class="n">complexOutputTypeElement</span><span class="p">)</span>
                <span class="n">supportedcomplexOutputFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">(</span><span class="n">complexOutputTypeElement</span><span class="p">)</span>
                <span class="c"># Store the output formats</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputsMetaInfo</span><span class="p">[</span><span class="n">outputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">supportedcomplexOutputFormat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputDataTypeList</span><span class="p">[</span><span class="n">outputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">complexOutputFormat</span>
                <span class="c"># Create and store port in list</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">outputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;output&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># via PortConfigurationWidget</span>

             <span class="c"># Iterate over all literal outputs</span>
            <span class="n">literalOutput</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;LiteralOutput&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">literalOutput</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Das i-te ComplexData Objekt auswerten</span>
                <span class="n">literalOutputTypeElement</span> <span class="o">=</span> <span class="n">literalOutput</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">literalOutputFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultMimeType</span><span class="p">(</span><span class="n">literalOutputTypeElement</span><span class="p">)</span>
                <span class="n">supportedliteralOutputFormat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">(</span><span class="n">literalOutputTypeElement</span><span class="p">)</span>
                <span class="c"># Store the output formats</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputsMetaInfo</span><span class="p">[</span><span class="n">outputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">supportedliteralOutputFormat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputDataTypeList</span><span class="p">[</span><span class="n">outputIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">literalOutputFormat</span>
                <span class="c"># Create and store port in list</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">outputIdentifier</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;output&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>  <span class="c"># via PortConfigurationWidget</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getProcessInfo"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getProcessInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getProcessInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get information about the selected web process&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">setContent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getServiceXML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processName</span><span class="p">,</span> <span class="s">&quot;DescribeProcess&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span><span class="p">))</span>
        <span class="n">dataInputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
        <span class="n">dataOutputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Output&quot;</span><span class="p">)</span>

        <span class="c">#QApplication.setOverrideCursor(Qt.WaitCursor)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processName</span><span class="p">)</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;scheme&quot;</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span>

        <span class="n">postString</span> <span class="o">=</span> <span class="s">&#39;&lt;wps:Execute service=&quot;WPS&quot; version=&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServiceVersion</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> \
                   <span class="s">&#39; xmlns:wps=&quot;http://www.opengis.net/wps/1.0.0&quot;&#39;</span> <span class="o">+</span> \
                   <span class="s">&#39; xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot;&#39;</span> <span class="o">+</span>\
                   <span class="s">&#39; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&#39;</span> <span class="o">+</span>\
                   <span class="s">&#39; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#39;</span>\
                   <span class="s">&#39; xsi:schemaLocation=&quot;http://www.opengis.net/wpsExecute_request.xsd&quot;&gt;&#39;</span>

        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;ows:Identifier&gt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span> <span class="o">+</span> <span class="s">&#39;&lt;/ows:Identifier&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:DataInputs&gt;&#39;</span> <span class="o">+</span> <span class="s">&quot;&lt;/wps:DataInputs&gt;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # MOVED LAYER-RELATED POST INFO TO &quot;WPS compute()&quot;</span>
<span class="sd">        # text/plain inputs</span>
<span class="sd">        for textBox in self.complexInputTextBoxList:</span>

<span class="sd">        # Do not add undefined inputs</span>
<span class="sd">            if textBox == None or str(textBox.document().toPlainText()) == &quot;&quot;:</span>
<span class="sd">                continue</span>
<span class="sd">            postString += xmlExecuteRequestInputStart(textBox.objectName())</span>
<span class="sd">            postString += &quot;&lt;wps:ComplexData&gt;&quot; + textBox.document().toPlainText() + &quot;&lt;/wps:ComplexData&gt;\n&quot;</span>
<span class="sd">            postString += xmlExecuteRequestInputEnd()</span>

<span class="sd">        # Literal data as combo box choice</span>
<span class="sd">        for comboBox in self.literalInputComboBoxList:</span>
<span class="sd">            if comboBox == None or comboBox.currentText() == &quot;&quot;:</span>
<span class="sd">                continue</span>
<span class="sd">            postString += xmlExecuteRequestInputStart(comboBox.objectName())</span>
<span class="sd">            postString += &quot;&lt;wps:LiteralData&gt;&quot; + comboBox.currentText() + &quot;&lt;/wps:LiteralData&gt;\n&quot;</span>
<span class="sd">            postString += xmlExecuteRequestInputEnd()</span>

<span class="sd">        # Literal data as combo box choice</span>
<span class="sd">        for lineEdit in self.literalInputLineEditList:</span>
<span class="sd">            if lineEdit == None or lineEdit.text() == &quot;&quot;:</span>
<span class="sd">                continue</span>
<span class="sd">            postString += xmlExecuteRequestInputStart(lineEdit.objectName())</span>
<span class="sd">            postString += &quot;&lt;wps:LiteralData&gt;&quot; + lineEdit.text() + &quot;&lt;/wps:LiteralData&gt;\n&quot;</span>
<span class="sd">            postString += xmlExecuteRequestInputEnd()</span>
<span class="sd">        postString += &quot;&lt;/wps:DataInputs&gt;\n&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Attach only defined outputs</span>
        <span class="k">if</span> <span class="n">dataOutputs</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;wps:ResponseForm&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="c"># The server might store the result. No lineage should be returned or status</span>
            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&#39;&lt;wps:ResponseDocument lineage=&quot;false&quot; status=&quot;false&quot; storeExecuteResponse=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> \
                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processAttributes</span><span class="p">[</span><span class="s">&#39;store&#39;</span><span class="p">])</span>


            <span class="c"># Attach ALL literal outputs</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataOutputs</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">f_element</span> <span class="o">=</span> <span class="n">dataOutputs</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">outputIdentifier</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;ows:Identifier&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
                <span class="n">literalOutputType</span> <span class="o">=</span> <span class="n">f_element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;LiteralOutput&quot;</span><span class="p">)</span>

                <span class="c"># Complex data is always requested as reference</span>
                <span class="k">if</span> <span class="n">literalOutputType</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;wps:Output&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;ows:Identifier&gt;&quot;</span> <span class="o">+</span> <span class="n">outputIdentifier</span> <span class="o">+</span> \
                                  <span class="s">&quot;&lt;/ows:Identifier&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:Output&gt;</span><span class="se">\n</span><span class="s">&quot;</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # Attach selected complex outputs</span>
<span class="sd">            for comboBox in self.complexOutputComboBoxList:</span>
<span class="sd">                # Do not add undefined outputs</span>
<span class="sd">                if comboBox == None or str(comboBox.currentText()) == &quot;&lt;None&gt;&quot;:</span>
<span class="sd">                    continue</span>
<span class="sd">                outputIdentifier = comboBox.objectName()</span>

<span class="sd">                mimeType = self.outputDataTypeList[outputIdentifier][&quot;MimeType&quot;]</span>
<span class="sd">                schema = self.outputDataTypeList[outputIdentifier][&quot;Schema&quot;]</span>
<span class="sd">                encoding = self.outputDataTypeList[outputIdentifier][&quot;Encoding&quot;]</span>

<span class="sd">                postString += &quot;&lt;wps:Output asReference=\&quot;true\&quot; mimeType=\&quot;&quot; +\</span>
<span class="sd">                              mimeType + &quot;\&quot; schema=\&quot;&quot; + schema + &quot;\&quot;&gt;&quot;</span>
<span class="sd">                postString += &quot;&lt;ows:Identifier&gt;&quot; + outputIdentifier + \</span>
<span class="sd">                              &quot;&lt;/ows:Identifier&gt;\n&quot;</span>
<span class="sd">                postString += &quot;&lt;/wps:Output&gt;\n&quot;</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:ResponseDocument&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:ResponseForm&gt;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="n">postString</span> <span class="o">+=</span> <span class="s">&quot;&lt;/wps:Execute&gt;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Determine full execute request URL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requestURL</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;url&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;?SERVICE=WPS&amp;VERSION=&#39;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">getServiceVersion</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;&amp;REQUEST=execute&amp;IDENTIFIER=&#39;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span>

        <span class="c"># Fixed ports</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">OGC_REQUEST_PORT</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">requestURL</span><span class="p">]),)</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">WPS_PROCESS_PORT</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">processIdentifier</span><span class="p">]),)</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">OGC_POST_DATA_PORT</span><span class="p">,</span> <span class="p">[</span><span class="n">postString</span><span class="p">]),)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">update_ports_and_functions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">functions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">popUpMessageBox</span><span class="p">(</span><span class="s">&quot;Execute request&quot;</span><span class="p">,</span> <span class="n">postString</span><span class="p">)</span>
            <span class="c"># Write the request into a file</span>
            <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">home</span> <span class="o">+</span> <span class="s">&#39;/Desktop/qwps_execute_request.xml&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">postString</span><span class="p">)</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getIdentifierTitleAbstractFromElement"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getIdentifierTitleAbstractFromElement">[docs]</a>    <span class="k">def</span> <span class="nf">getIdentifierTitleAbstractFromElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return identifier, title, abstract, mime_type from an element&quot;&quot;&quot;</span>
        <span class="n">inputIdentifier</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Identifier&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span>
        <span class="n">mime_type</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span>
            <span class="s">&quot;MimeType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">inputIdentifier</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">mime_type</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getDefaultMimeType"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getDefaultMimeType">[docs]</a>    <span class="k">def</span> <span class="nf">getDefaultMimeType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inElement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">myElement</span> <span class="o">=</span> <span class="n">inElement</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMimeTypeSchemaEncoding</span><span class="p">(</span><span class="n">myElement</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getSupportedMimeTypes"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getSupportedMimeTypes">[docs]</a>    <span class="k">def</span> <span class="nf">getSupportedMimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inElement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">mimeTypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">myElements</span> <span class="o">=</span> <span class="n">inElement</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&quot;Supported&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
        <span class="n">myFormats</span> <span class="o">=</span> <span class="n">myElements</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span><span class="s">&#39;Format&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">myFormats</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
            <span class="n">myElement</span> <span class="o">=</span> <span class="n">myFormats</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
            <span class="n">mimeTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMimeTypeSchemaEncoding</span><span class="p">(</span><span class="n">myElement</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mimeTypes</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getMimeTypeSchemaEncoding"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getMimeTypeSchemaEncoding">[docs]</a>    <span class="k">def</span> <span class="nf">getMimeTypeSchemaEncoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">mime_type</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mime_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span>
                <span class="s">&quot;MimeType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">())</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span>
                <span class="s">&quot;Schema&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">())</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Element</span><span class="o">.</span><span class="n">elementsByTagName</span><span class="p">(</span>
                <span class="s">&quot;Encoding&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">simplified</span><span class="p">()</span><span class="o">.</span><span class="n">toLower</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;MimeType&quot;</span><span class="p">:</span> <span class="n">mime_type</span><span class="p">,</span> <span class="s">&quot;Schema&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="p">,</span> <span class="s">&quot;Encoding&quot;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.allowedValues"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.allowedValues">[docs]</a>    <span class="k">def</span> <span class="nf">allowedValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aValues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">valList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Manage a value list defined by a range</span>
        <span class="n">value_element</span> <span class="o">=</span> <span class="n">aValues</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
        <span class="n">v_range_element</span> <span class="o">=</span> <span class="n">value_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span><span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Range&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_range_element</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">value_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
                <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;MinimumValue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">value_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
                <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;MaximumValue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min_val</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">myVal</span> <span class="o">=</span> <span class="n">QString</span><span class="p">()</span>
                <span class="n">myVal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">valList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">myVal</span><span class="p">)</span>
        <span class="c"># Manage a value list defined by single values</span>
        <span class="n">v_element</span> <span class="o">=</span> <span class="n">value_element</span><span class="o">.</span><span class="n">elementsByTagNameNS</span><span class="p">(</span>
            <span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_element</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v_element</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
                <span class="n">mv_element</span> <span class="o">=</span> <span class="n">v_element</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">toElement</span><span class="p">()</span>
                <span class="n">valList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">mv_element</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="s">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">valList</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.popUpMessageBox"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.popUpMessageBox">[docs]</a>    <span class="k">def</span> <span class="nf">popUpMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">detailedText</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A message box used for debugging&quot;&quot;&quot;</span>
        <span class="n">mbox</span> <span class="o">=</span> <span class="n">WPSMessageBox</span><span class="p">()</span>
        <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">mbox</span><span class="o">.</span><span class="n">setDetailedText</span><span class="p">(</span><span class="n">detailedText</span><span class="p">)</span>
        <span class="n">mbox</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WPSConfigurationWidget.getDBEncoding"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSConfigurationWidget.getDBEncoding">[docs]</a>    <span class="k">def</span> <span class="nf">getDBEncoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerProvider</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: add doc string&quot;&quot;&quot;</span>
        <span class="n">dbConnection</span> <span class="o">=</span> <span class="n">QgsDataSourceURI</span><span class="p">(</span><span class="n">layerProvider</span><span class="o">.</span><span class="n">dataSourceUri</span><span class="p">())</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s">&quot;QPSQL&quot;</span><span class="p">,</span> <span class="s">&quot;WPSClient&quot;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setHostName</span><span class="p">(</span><span class="n">dbConnection</span><span class="o">.</span><span class="n">host</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="n">dbConnection</span><span class="o">.</span><span class="n">database</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setUserName</span><span class="p">(</span><span class="n">dbConnection</span><span class="o">.</span><span class="n">username</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setPassword</span><span class="p">(</span><span class="n">dbConnection</span><span class="o">.</span><span class="n">password</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setPort</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dbConnection</span><span class="o">.</span><span class="n">port</span><span class="p">()))</span>
        <span class="n">db</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;select pg_encoding_to_char(encoding) as encoding &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s">&quot;from pg_catalog.pg_database &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s">&quot;where datname = &#39;&quot;</span> <span class="o">+</span> <span class="n">dbConnection</span><span class="o">.</span><span class="n">database</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;&#39; &quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">QSqlQuery</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">encoding</span>

</div></div>
<div class="viewcode-block" id="WPSMessageBox"><a class="viewcode-back" href="../../../geoinf.html#geoinf.ogc.WPS.WPSMessageBox">[docs]</a><span class="k">class</span> <span class="nc">WPSMessageBox</span><span class="p">(</span><span class="n">QMessageBox</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A resizable message box to show debug info&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSizeGripEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">16777215</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">16777215</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="n">textEdit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QTextEdit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">textEdit</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">textEdit</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">textEdit</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">16777215</span><span class="p">)</span>
            <span class="n">textEdit</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">textEdit</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">16777215</span><span class="p">)</span>
            <span class="n">textEdit</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">EO4vistrails v1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Meraka Institute, CSIR.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>